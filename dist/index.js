var e,t=(e=require("peerjs"))&&"object"==typeof e&&"default"in e?e.default:e,n=require("automerge");module.exports=function(){function e(e,o){var c=this;void 0===o&&(o={}),this._connections={},this._actorId=e,this._peerInstance=o.peerInstance||new t(this._actorId),this._docSet=o.docSet||new n.DocSet,this._encode=o.encode||JSON.stringify,this._decode=o.decode||JSON.parse,this._peerInstance.on("connection",function(e){e.on("data",function(t){c._connections[e.peer].receiveMsg(c._decode(t))})})}var o,c=e.prototype;return c.connect=function(e,t){var o=this;if(!this._connections[e]){var c=t||this._peerInstance.connect(e),r=this._connections[e]=new n.Connection(this._docSet,function(e){c.send(o._encode(e))});c.on("disconnected",function(){r.close(),delete o._connections[e]}),r.open()}},c.select=function(e){var t=this,o=this.docSet.getDoc(e)||n.init(this._actorId);return function(n){for(var c=arguments.length,r=new Array(c>1?c-1:0),i=1;i<c;i++)r[i-1]=arguments[i];var s=n.apply(void 0,[o].concat(r));return t.docSet.setDoc(e,s),s}},c.subscribe=function(e,t){var n=this;if("function"==typeof e)return this.docSet.handlers=this.docSet.handlers.add(e),function(){return n.docSet.handlers=n.docSet.handlers.delete(e)};if("string"==typeof e){var o=function(n,o){n===e&&t(o)};return this.docSet.handlers=this.docSet.handlers.add(o),function(){return n.docSet.handlers=n.docSet.handlers.delete(o)}}},(o=[{key:"docSet",get:function(){return this._docSet}}])&&function(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}(e.prototype,o),e}();
//# sourceMappingURL=index.js.map
